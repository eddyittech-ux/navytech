<!doctype html>
<html lang="es" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NavyTech</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{--glass:rgba(255,255,255,.08);--glass-b:rgba(0,0,0,.15)}
    .dark .gs-card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));}
    .gs-card{background:linear-gradient(180deg,rgba(0,0,0,.04),rgba(0,0,0,.02));border:1px solid rgba(255,255,255,.08);border-radius:18px;box-shadow:0 6px 24px rgba(0,0,0,.18);}
    .gs-btn{border:1px solid rgba(255,255,255,.2);padding:.4rem .7rem;border-radius:.8rem}
    .gs-chip{border:1px solid currentColor;border-radius:999px;padding:.08rem .5rem;display:inline-block}
    .hidden-vis{display:none}
    .icon-sm{width:18px;height:18px}
  </style>

  <!-- Flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
</head>
<body class="h-full bg-slate-100 text-slate-900 dark:bg-slate-900 dark:text-slate-100">

  <!-- Navbar -->
  <header class="sticky top-0 z-10 backdrop-blur bg-black/10">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="w-7 h-7 rounded-xl bg-gradient-to-br from-indigo-700 to-slate-600"></div>
      <a href="#/resumen" class="text-lg font-semibold"><span class="text-blue-900 dark:text-blue-300">Navy</span><span class="text-indigo-900 dark:text-indigo-300">Tech</span></a>

      <nav id="mainNav" class="ml-6 flex gap-3 text-sm">
        <a class="nav-link px-3 py-1 rounded-lg hover:bg-white/10" href="#/resumen">Resumen</a>
        <a class="nav-link px-3 py-1 rounded-lg hover:bg-white/10" href="#/acuerdos">Acuerdos</a>
        <a class="nav-link px-3 py-1 rounded-lg hover:bg-white/10" href="#/metas">Metas</a>
        <a class="nav-link px-3 py-1 rounded-lg hover:bg-white/10" href="#/luces">Luces</a>
        <a class="nav-link px-3 py-1 rounded-lg hover:bg-white/10" href="#/juegos">Juegos</a>
        <a class="nav-link px-3 py-1 rounded-lg hover:bg-white/10" href="#/ajustes">Ajustes</a>
      </nav>

      <div class="ml-auto flex items-center gap-2" id="authActions">
        <!-- Theme -->
        <button id="themeToggle" class="w-9 h-9 rounded-xl gs-btn flex items-center justify-center" title="Cambiar tema">
          <svg id="themeIcon" viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor"></svg>
        </button>
        <!-- Usuario -->
        <div class="w-9 h-9 rounded-xl gs-btn flex items-center justify-center" title="" id="userTooltip">
          <svg viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor">
            <circle cx="12" cy="8" r="3"></circle><path d="M5 20c2.5-4 11.5-4 14 0"></path>
          </svg>
        </div>
        <!-- Logout -->
        <button id="logoutBtn" class="w-9 h-9 rounded-xl gs-btn flex items-center justify-center" title="Salir">
          <svg viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor">
            <path d="M16 17l5-5-5-5"/><path d="M21 12H9"/><path d="M13 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h8"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <!-- Login -->
    <section id="authCard" class="max-w-lg mx-auto gs-card p-6">
      <h2 class="text-xl font-semibold mb-4">Iniciar sesión</h2>
      <form id="loginForm" class="space-y-3">
        <div>
          <label class="text-sm">Email</label>
          <input id="emailInput" type="email" class="w-full mt-1 px-3 py-2 rounded-lg bg-white/50 dark:bg-white/10 border border-white/20" />
        </div>
        <div>
          <label class="text-sm">Password</label>
          <input id="passwordInput" type="password" class="w-full mt-1 px-3 py-2 rounded-lg bg-white/50 dark:bg-white/10 border border-white/20" />
        </div>
        <button id="loginBtn" class="gs-btn bg-yellow-600/60 hover:bg-yellow-600/80 text-black font-medium">Entrar</button>
      </form>
      <p class="mt-3 text-xs opacity-70">Solo usuarios permitidos (Eddy y Dani).</p>
    </section>

    <!-- App Views -->
    <section id="appViews" class="space-y-6 hidden-vis">

      <!-- Resumen -->
      <section id="view-resumen" class="gs-card p-5">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-semibold">Resumen</h3>
          <span class="text-xs opacity-60">v0.5</span>
        </div>
        <div id="resumeStats"></div>
      </section>

      <!-- Luces -->
      <section id="view-luces" class="gs-card p-5 hidden-vis">
        <div class="flex items-center justify-between gap-3 mb-4">
          <h3 class="text-lg font-semibold">Luces</h3>
          <div class="flex items-center gap-2">
            <select id="lightsRangeType" class="gs-btn">
              <option value="week">Semana</option>
              <option value="month">Mes</option>
            </select>
            <input id="lightsRangeStart" class="gs-btn px-3" placeholder="yyyy-mm-dd"/>
            <select id="lightsWho" class="gs-btn">
              <option value="">Todos</option>
              <option value="Eddy">Eddy</option>
              <option value="Dani">Dani</option>
            </select>
            <button id="addLightBtn" class="w-9 h-9 rounded-xl gs-btn flex items-center justify-center" title="Agregar">
              <svg viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor"><path d="M12 5v14M5 12h14"/></svg>
            </button>
          </div>
        </div>
        <div id="lightsStats" class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-4"></div>
        <div id="lightsList" class="space-y-3"></div>
      </section>

      <!-- Juegos (lista simple; deja de romper) -->
      <section id="view-juegos" class="gs-card p-5 hidden-vis">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-semibold">Juegos</h3>
        </div>
        <div id="gamesList" class="text-sm opacity-70">Cargando…</div>
      </section>

      <!-- Acuerdos -->
      <section id="view-acuerdos" class="gs-card p-5 hidden-vis">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-semibold">Acuerdos</h3>
        </div>
        <div id="agreementsList" class="text-sm opacity-70">Cargando…</div>
      </section>

      <!-- Metas -->
      <section id="view-metas" class="gs-card p-5 hidden-vis">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-semibold">Metas</h3>
        </div>
        <div id="goalsList" class="text-sm opacity-70">Cargando…</div>
      </section>

      <!-- Ajustes -->
      <section id="view-ajustes" class="space-y-6 hidden-vis">
        <div class="gs-card p-5">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-lg font-semibold">Ajustes · Contactos</h3>
            <button id="addContactFab" class="w-9 h-9 rounded-xl gs-btn flex items-center justify-center">
              <svg viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor"><path d="M12 5v14M5 12h14"/></svg>
            </button>
          </div>
          <select id="filterStatus" class="gs-btn mb-4">
            <option value="">Todos</option>
            <option>Bloqueado</option><option>Silenciado</option><option>Archivado</option>
            <option>Eliminado</option><option>Inaccesible</option><option>Conservado</option>
          </select>
          <div id="contactsList" class="space-y-3"></div>
        </div>

        <div class="gs-card p-5">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-lg font-semibold">Ajustes · Prácticas</h3>
            <button id="addPracticeBtn" class="w-9 h-9 rounded-xl gs-btn flex items-center justify-center">
              <svg viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor"><path d="M12 5v14M5 12h14"/></svg>
            </button>
          </div>
          <div id="practicesList" class="text-sm opacity-70">Cargando…</div>
        </div>
      </section>
    </section>
  </main>

  <!-- Modal: Light -->
  <dialog id="lightModal" class="p-0 rounded-2xl w-[560px] max-w-[92vw]">
    <form id="lightForm" class="gs-card p-5">
      <div class="flex items-center justify-between mb-3">
        <h3 id="lightModalTitle" class="text-lg font-semibold">Nueva entrada</h3>
        <div class="flex items-center gap-2">
          <button type="button" id="deleteLightBtn" class="gs-btn hidden-vis" title="Borrar">
            <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M6 7h12M10 11v6M14 11v6M9 7l1-2h4l1 2M7 7l1 12h8l1-12"/></svg>
          </button>
          <button type="button" id="closeLightModal" class="gs-btn" title="Cerrar">✕</button>
        </div>
      </div>
      <input type="hidden" id="lightId" />
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="text-sm">Fecha</label>
          <input id="lightDate" class="w-full mt-1 px-3 py-2 rounded-lg bg-white/50 dark:bg-white/10 border border-white/20" />
        </div>
        <div>
          <label class="text-sm">Color</label>
          <select id="lightColor" class="w-full mt-1 px-3 py-2 rounded-lg bg-white/50 dark:bg-white/10 border border-white/20">
            <option>Rojo</option><option>Ámbar</option><option>Verde</option><option>Azul</option>
          </select>
        </div>
        <div>
          <label class="text-sm">Quién</label>
          <select id="lightWho" class="w-full mt-1 px-3 py-2 rounded-lg bg-white/50 dark:bg-white/10 border border-white/20">
            <option>Eddy</option><option>Dani</option>
          </select>
        </div>
        <div>
          <label class="text-sm">Sensación</label>
          <select id="lightEmotion" class="w-full mt-1 px-3 py-2 rounded-lg bg-white/50 dark:bg-white/10 border border-white/20">
            <!-- opciones en ui.js -->
          </select>
        </div>
        <div class="col-span-2">
          <label class="text-sm">Acción</label>
          <input id="lightAction" class="w-full mt-1 px-3 py-2 rounded-lg bg-white/50 dark:bg-white/10 border border-white/20" />
        </div>
        <div class="col-span-2">
          <label class="text-sm">Notas</label>
          <textarea id="lightNotes" rows="3" class="w-full mt-1 px-3 py-2 rounded-lg bg-white/50 dark:bg-white/10 border border-white/20"></textarea>
        </div>
      </div>
      <div class="mt-4 flex justify-end">
        <button class="gs-btn bg-yellow-600/70 text-black font-medium">Guardar</button>
      </div>
    </form>
  </dialog>

  <!-- Toasts -->
  <div id="toastHost" class="fixed bottom-3 right-3 z-50 space-y-2"></div>

  <!-- App core + UI -->
  <script src="./app.js"></script>
  <script src="./ui.js"></script>
</body>
</html>
