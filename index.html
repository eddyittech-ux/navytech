<!doctype html>
<html lang="es" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NavyTech</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><circle cx=%228%22 cy=%228%22 r=%228%22 fill=%22%233F3D8F%22/></svg>">

  <!-- Tailwind vía CDN (ok para GitHub Pages) -->
  <script src="https://cdn.tailwindcss.com"></script>
<!-- Usa ruta relativa (GH Pages) y versiona para bust cache -->
<link rel="stylesheet" href="./styles.css?v=0.5.0">

<!-- Fallback crítico por si la hoja no carga (evita que se mezcle login/app) -->
<style>
  .hidden-vis{display:none!important;}
  /* Unos mínimos para que no se vea roto si falla styles.css */
  .gs-card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);
           border-radius:16px;padding:1rem;backdrop-filter:blur(6px)}
  .gs-btn{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem .75rem;
          border:1px solid rgba(255,255,255,.18);border-radius:12px}
  .icon-sm{width:18px;height:18px}
</style>

  <!-- Flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <link rel="stylesheet" href="./styles.css">
</head>
<body class="min-h-full bg-slate-100 dark:bg-[#0f1623] text-slate-900 dark:text-slate-100">

  <!-- Top bar -->
  <header class="sticky top-0 z-30 backdrop-blur bg-white/60 dark:bg-[#0f1623]/60 border-b border-white/10">
    <div class="max-w-6xl mx-auto px-4 h-14 flex items-center justify-between">
      <nav id="brand" class="flex items-center gap-3">
        <div class="w-7 h-7 rounded-2xl bg-gradient-to-br from-indigo-700 to-slate-600"></div>
        <a href="#/resumen" class="text-xl font-bold tracking-tight">
          <span class="text-[#163054]">Navy</span><span class="text-[#3F3D8F]">Tech</span>
        </a>
      </nav>

      <nav id="mainNav" class="hidden-vis flex items-center gap-2">
        <a class="nav-link" href="#/resumen">Resumen</a>
        <a class="nav-link" href="#/acuerdos">Acuerdos</a>
        <a class="nav-link" href="#/metas">Metas</a>
        <a class="nav-link" href="#/luces">Luces</a>
        <a class="nav-link" href="#/juegos">Juegos</a>
        <a class="nav-link" href="#/ajustes">Ajustes</a>
      </nav>

      <div id="authActions" class="hidden-vis flex items-center gap-2">
        <!-- Theme -->
        <button id="themeToggle" class="gs-icon-btn" title="Tema">
          <svg id="themeIcon" viewBox="0 0 24 24" class="icon-sm"></svg>
        </button>
        <!-- User -->
        <div class="relative group">
          <button class="gs-icon-btn" title="Usuario">
            <svg viewBox="0 0 24 24" class="icon-sm" fill="none">
              <circle cx="12" cy="8" r="3.2" stroke="currentColor" stroke-width="1.8"/>
              <path d="M5 20c2-3.5 12-3.5 14 0" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </button>
          <div class="absolute right-0 mt-2 hidden group-hover:block text-xs bg-black/70 text-white rounded px-2 py-1">
            <span id="userTooltip"></span>
          </div>
        </div>
        <!-- Logout -->
        <button id="logoutBtn" class="gs-icon-btn" title="Salir">
          <svg viewBox="0 0 24 24" class="icon-sm" fill="none">
            <path d="M10 6H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h4" stroke="currentColor" stroke-width="1.8"/>
            <path d="M14 16l4-4-4-4M18 12H9" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Login -->
  <main class="max-w-6xl mx-auto px-4 py-6">
    <section id="authCard" class="max-w-xl mx-auto">
      <div class="gs-card p-8">
        <h2 class="text-xl font-semibold mb-4">Iniciar sesión</h2>
        <form id="loginForm" class="space-y-4">
          <label class="gs-field">
            <span>Email</span>
            <input id="emailInput" type="email" class="gs-input" />
          </label>
          <label class="gs-field">
            <span>Password</span>
            <input id="passwordInput" type="password" class="gs-input" />
          </label>
          <div class="flex items-center gap-3">
            <button id="loginBtn" type="submit" class="gs-btn primary">Entrar</button>
            <div class="text-xs opacity-60">Solo usuarios permitidos (Eddy y Dani).</div>
          </div>
        </form>
      </div>
    </section>

    <!-- App views -->
    <section id="appViews" class="hidden-vis space-y-6">
      <!-- Resumen -->
      <section id="view-resumen" class="hidden-vis">
        <div class="gs-card p-4">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">Resumen</h3>
            <div class="text-xs opacity-60">v0.4</div>
          </div>
          <div id="resumeStats"></div>
        </div>
      </section>

      <!-- Acuerdos -->
      <section id="view-acuerdos" class="hidden-vis">
        <div class="gs-card p-4">
          <div class="flex items-center gap-2 mb-3">
            <select id="agreFilterStatus" class="gs-input">
              <option value="">Todos</option>
              <option value="Aprobado">Aprobados</option>
              <option value="Pendiente">Pendientes</option>
              <option value="Rechazado">Rechazados</option>
            </select>
            <button id="addAgreementBtn" class="gs-icon-btn" title="Agregar">
              <svg viewBox="0 0 24 24" class="icon-sm"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
            </button>
          </div>
          <div id="agreementsList"></div>
        </div>

        <!-- Modal acuerdo -->
        <dialog id="agreementModal" class="gs-modal">
          <form id="agreementForm" method="dialog" class="gs-modal-card">
            <div class="flex items-center justify-between mb-2">
              <h3 id="agreementModalTitle" class="text-lg font-semibold">Nuevo acuerdo</h3>
              <button type="button" id="closeAgreementModal" class="gs-icon-btn">
                <svg viewBox="0 0 24 24" class="icon-sm"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
              </button>
            </div>

            <input id="agreementId" type="hidden" />
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <label class="gs-field">
                <span>Categoría</span>
                <select id="agreementCategory" class="gs-input"></select>
              </label>
              <label class="gs-field">
                <span>Fecha</span>
                <input id="agreementDate" class="gs-input" placeholder="yyyy-mm-dd"/>
              </label>
              <label class="gs-field">
                <span>Promotor</span>
                <select id="agreementPromoter" class="gs-input">
                  <option>Eddy</option><option>Ambos</option><option>Dani</option>
                </select>
              </label>
              <label class="gs-field">
                <span>Estado</span>
                <input id="agreementStatusRO" class="gs-input" readonly />
              </label>
              <label class="gs-field md:col-span-2">
                <span>Acuerdo</span>
                <input id="agreementTitle" class="gs-input"/>
              </label>
              <label class="gs-field md:col-span-2">
                <span>Notas</span>
                <textarea id="agreementNotes" class="gs-input" rows="3"></textarea>
              </label>
              <label class="gs-field">
                <span>Eddy</span>
                <select id="eddyDecision" class="gs-input">
                  <option value="none">—</option>
                  <option value="approve">Aprueba</option>
                  <option value="reject">Rechaza</option>
                </select>
              </label>
              <label class="gs-field">
                <span>Dani</span>
                <select id="daniDecision" class="gs-input">
                  <option value="none">—</option>
                  <option value="approve">Aprueba</option>
                  <option value="reject">Rechaza</option>
                </select>
              </label>
            </div>

            <div class="mt-4 flex items-center justify-between">
              <button type="button" id="deleteAgreementBtn" class="gs-btn danger hidden-vis">Borrar</button>
              <button type="submit" class="gs-btn primary">Guardar</button>
            </div>
          </form>
        </dialog>
      </section>

      <!-- Metas -->
      <section id="view-metas" class="hidden-vis">
        <div class="gs-card p-4">
          <div class="flex items-center gap-2 mb-3">
            <select id="goalsFilterPromoter" class="gs-input">
              <option value="Todos">Todos</option>
              <option value="Eddy">Eddy</option>
              <option value="Dani">Dani</option>
              <option value="Ambos">Ambos</option>
            </select>
            <select id="goalsFilterStatus" class="gs-input">
              <option value="todas">Todas</option>
              <option value="plan">Plan</option>
              <option value="en_curso">En curso</option>
              <option value="pausada">Pausada</option>
              <option value="cumplida">Cumplida</option>
            </select>
            <button id="addGoalBtn" class="gs-icon-btn" title="Agregar">
              <svg viewBox="0 0 24 24" class="icon-sm"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
            </button>
          </div>
          <div id="goalsList"></div>
        </div>

        <dialog id="goalModal" class="gs-modal">
          <form id="goalForm" method="dialog" class="gs-modal-card">
            <div class="flex items-center justify-between mb-2">
              <h3 id="goalModalTitle" class="text-lg font-semibold">Nueva meta</h3>
              <button type="button" id="closeGoalModal" class="gs-icon-btn">
                <svg viewBox="0 0 24 24" class="icon-sm"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
              </button>
            </div>
            <input id="goalId" type="hidden" />
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <label class="gs-field">
                <span>Promotor</span>
                <select id="goalPromoter" class="gs-input">
                  <option>Eddy</option><option>Dani</option><option>Ambos</option>
                </select>
              </label>
              <label class="gs-field">
                <span>Fecha límite</span>
                <input id="goalDeadline" class="gs-input" placeholder="yyyy-mm-dd"/>
              </label>
              <label class="gs-field md:col-span-2">
                <span>Meta</span>
                <input id="goalTitle" class="gs-input"/>
              </label>
              <label class="gs-field">
                <span>Estado</span>
                <select id="goalStatus" class="gs-input">
                  <option value="plan">Plan</option>
                  <option value="en_curso">En curso</option>
                  <option value="pausada">Pausada</option>
                  <option value="cumplida">Cumplida</option>
                </select>
              </label>
              <label class="gs-field">
                <span>Progreso %</span>
                <input id="goalProgress" type="number" min="0" max="100" class="gs-input" />
              </label>
              <label class="gs-field md:col-span-2">
                <span>Notas</span>
                <textarea id="goalNotes" class="gs-input" rows="3"></textarea>
              </label>
            </div>
            <div class="mt-4 flex items-center justify-between">
              <button type="button" id="deleteGoalBtn" class="gs-btn danger hidden-vis">Borrar</button>
              <button type="submit" class="gs-btn primary">Guardar</button>
            </div>
          </form>
        </dialog>
      </section>

      <!-- Luces -->
      <section id="view-luces" class="hidden-vis">
        <div class="gs-card p-4">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-lg font-semibold">Luces</h3>
            <div class="flex items-center gap-2">
              <select id="lightsRangeType" class="gs-input">
                <option value="week">Semana</option>
                <option value="month">Mes</option>
              </select>
              <input id="lightsRangeStart" class="gs-input" placeholder="yyyy-mm-dd" />
              <select id="lightsWho" class="gs-input">
                <option value="Todos">Todos</option>
                <option value="Eddy">Eddy</option>
                <option value="Dani">Dani</option>
              </select>
              <button id="addLightBtn" class="gs-icon-btn" title="Agregar">
                <svg viewBox="0 0 24 24" class="icon-sm"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
              </button>
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3" id="lightsStats"></div>
          <div id="lightsList"></div>
        </div>

        <!-- Modal luces -->
        <dialog id="lightModal" class="gs-modal">
          <form id="lightForm" method="dialog" class="gs-modal-card">
            <div class="flex items-center justify-between mb-2">
              <h3 id="lightModalTitle" class="text-lg font-semibold">Nueva entrada</h3>
              <button type="button" id="closeLightModal" class="gs-icon-btn">
                <svg viewBox="0 0 24 24" class="icon-sm"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
              </button>
            </div>
            <input id="lightId" type="hidden" />
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <label class="gs-field">
                <span>Fecha</span>
                <input id="lightDate" class="gs-input" placeholder="yyyy-mm-dd" />
              </label>
              <label class="gs-field">
                <span>Color</span>
                <select id="lightColor" class="gs-input">
                  <option>Rojo</option><option>Ámbar</option><option>Verde</option><option>Azul</option>
                </select>
              </label>
              <label class="gs-field">
                <span>Quién</span>
                <select id="lightWho" class="gs-input">
                  <option>Eddy</option><option>Dani</option>
                </select>
              </label>
              <label class="gs-field">
                <span>Sensación</span>
                <select id="lightEmotion" class="gs-input">
                  <option>feliz</option><option>muy_feliz</option><option>emocionado</option><option>agradecido</option><option>confiado</option><option>aliviado</option>
                  <option>meh</option><option>cansado</option><option>nervioso</option>
                  <option>triste</option><option>muy_triste</option><option>frustrado</option><option>estresado</option><option>ansioso</option><option>furioso</option>
                </select>
              </label>
              <label class="gs-field md:col-span-2">
                <span>Acción</span>
                <input id="lightAction" class="gs-input" />
              </label>
              <label class="gs-field md:col-span-2">
                <span>Notas</span>
                <textarea id="lightNotes" class="gs-input" rows="3"></textarea>
              </label>
            </div>
            <div class="mt-4 flex items-center justify-between">
              <button type="button" id="deleteLightBtn" class="gs-btn danger hidden-vis">Borrar</button>
              <button type="submit" class="gs-btn primary">Guardar</button>
            </div>
          </form>
        </dialog>
      </section>

      <!-- Juegos -->
      <section id="view-juegos" class="hidden-vis">
        <div class="gs-card p-4">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-lg font-semibold">Juegos</h3>
            <button id="addGameBtn" class="gs-icon-btn" title="Agregar">
              <svg viewBox="0 0 24 24" class="icon-sm"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
            </button>
          </div>
          <div id="gamesList"></div>
        </div>

        <!-- Modal juego -->
        <dialog id="gameModal" class="gs-modal">
          <form id="gameForm" method="dialog" class="gs-modal-card">
            <div class="flex items-center justify-between mb-2">
              <h3 id="gameModalTitle" class="text-lg font-semibold">Nuevo juego</h3>
              <button type="button" id="closeGameModal" class="gs-icon-btn">
                <svg viewBox="0 0 24 24" class="icon-sm"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
              </button>
            </div>
            <input id="gameId" type="hidden" />
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <label class="gs-field">
                <span>Fecha</span>
                <input id="gameDate" class="gs-input" placeholder="yyyy-mm-dd"/>
              </label>
              <label class="gs-field">
                <span>Tipo</span>
                <select id="gameKind" class="gs-input"><option value="juego">Juego</option><option value="mini">Mini-juego</option></select>
              </label>
              <label class="gs-field">
                <span>Promotor</span>
                <select id="gamePromoter" class="gs-input"><option>Eddy</option><option>Dani</option><option>Ambos</option></select>
              </label>
              <label class="gs-field">
                <span>Condón</span>
                <select id="gameCondom" class="gs-input"><option value="true">Sí</option><option value="false">No</option></select>
              </label>
              <label class="gs-field">
                <span>Rol</span>
                <select id="gameRole" class="gs-input">
                  <option>Ambos versátiles</option>
                  <option>Eddy→Dani</option>
                  <option>Dani→Eddy</option>
                </select>
              </label>
              <label class="gs-field">
                <span>Juguetes</span>
                <select id="gameToys" class="gs-input"><option value="false">No</option><option value="true">Sí</option></select>
              </label>
              <label class="gs-field">
                <span>Juguetes con</span>
                <input id="gameToysWith" class="gs-input" />
              </label>
              <label class="gs-field">
                <span>Lechita</span>
                <select id="gameCream" class="gs-input"><option>Ninguno</option><option>Eddy→Dani</option><option>Dani→Eddy</option></select>
              </label>
              <label class="gs-field">
                <span>Lugar</span>
                <input id="gameLocation" list="locList" class="gs-input"/>
                <datalist id="locList"></datalist>
              </label>
              <label class="gs-field">
                <span>Satisfacción</span>
                <input id="gameSatisfaction" type="range" min="1" max="10" value="7" class="w-full"/>
              </label>
              <div class="flex items-center justify-center" id="satisfactionGauge"></div>
              <label class="gs-field md:col-span-2">
                <span>Notas</span>
                <textarea id="gameNotes" class="gs-input" rows="3"></textarea>
              </label>
              <div class="md:col-span-2">
                <div class="text-xs opacity-70 mb-1">Prácticas</div>
                <div id="practicesChecklist" class="grid grid-cols-1 md:grid-cols-3 gap-2"></div>
              </div>
            </div>
            <div class="mt-4 flex items-center justify-between">
              <button type="button" id="deleteGameBtn" class="gs-btn danger hidden-vis">Borrar</button>
              <button type="submit" class="gs-btn primary">Guardar</button>
            </div>
          </form>
        </dialog>
      </section>

      <!-- Ajustes (Contactos + Prácticas) -->
      <section id="view-ajustes" class="hidden-vis space-y-6">
        <!-- Contactos -->
        <div class="gs-card p-4">
          <div class="flex items-center gap-2 mb-3">
            <h3 class="text-lg font-semibold">Ajustes · Contactos</h3>
            <select id="filterStatus" class="gs-input">
              <option value="">Todos</option>
              <option value="Bloqueado">Bloqueado</option>
              <option value="Silenciado">Silenciado</option>
              <option value="Archivado">Archivado</option>
              <option value="Eliminado">Eliminado</option>
              <option value="Inaccesible">Inaccesible</option>
              <option value="Conservado">Conservado</option>
            </select>
            <button id="addContactFab" class="gs-icon-btn" title="Agregar">
              <svg viewBox="0 0 24 24" class="icon-sm"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
            </button>
          </div>
          <div id="contactsList"></div>
        </div>

        <dialog id="contactModal" class="gs-modal">
          <form id="contactForm" method="dialog" class="gs-modal-card">
            <div class="flex items-center justify-between mb-2">
              <h3 id="modalTitle" class="text-lg font-semibold">Nuevo contacto</h3>
              <button type="button" id="closeModal" class="gs-icon-btn">
                <svg viewBox="0 0 24 24" class="icon-sm"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
              </button>
            </div>
            <input id="contactId" type="hidden" />
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <label class="gs-field"><span>Owner</span>
                <select id="ownerInput" class="gs-input"><option>Eddy</option><option>Dani</option></select>
              </label>
              <label class="gs-field"><span>Nombre</span><input id="nameInput" class="gs-input"/></label>
              <label class="gs-field md:col-span-2"><span>Alias</span><input id="aliasInput" class="gs-input"/></label>
              <label class="gs-field"><span>Clasificación</span>
                <select id="categoryInput" class="gs-input"><option>Rojo</option><option>Ámbar</option><option>Verde</option><option>Azul</option></select>
              </label>
              <label class="gs-field"><span>Estado Actual</span>
                <select id="statusInput" class="gs-input">
                  <option>Eliminado</option><option>Bloqueado</option><option>Silenciado</option>
                  <option>Archivado</option><option>Inaccesible</option><option>Conservado</option>
                </select>
              </label>
              <label class="gs-field md:col-span-2"><span>Trato</span>
                <input id="treatmentInput" class="gs-input" placeholder="Eliminar, Bloquear, Silenciar, Mantener..." />
              </label>
              <label class="gs-field md:col-span-2"><span>Notas</span>
                <textarea id="notesInput" class="gs-input" rows="3"></textarea>
              </label>
            </div>
            <div class="mt-4 flex items-center justify-between">
              <button type="button" id="deleteBtn" class="gs-btn danger hidden-vis">Borrar</button>
              <button type="submit" class="gs-btn primary">Guardar</button>
            </div>
          </form>
        </dialog>

        <!-- Prácticas -->
        <div class="gs-card p-4">
          <div class="flex items-center gap-2 mb-3">
            <h3 class="text-lg font-semibold">Ajustes · Prácticas</h3>
            <button id="addPracticeBtn" class="gs-icon-btn" title="Agregar">
              <svg viewBox="0 0 24 24" class="icon-sm"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
            </button>
          </div>
          <div id="practicesList"></div>
        </div>
      </section>
    </section>
  </main>

  <div id="toastHost" class="fixed left-4 bottom-4 space-y-2 z-50"></div>

  <script src="./app.js"></script>
  <script src="./ui.js"></script>
</body>
</html>

